<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Test Error Corregido - setupPaymentData</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #fff;
        }
        .hero {
            background: linear-gradient(135deg, #51cf66, #007aff);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 25px;
        }
        .section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #404040;
        }
        .success { background: #1e4d1e; border-color: #51cf66; }
        .warning { background: #4d3d1e; border-color: #ffd43b; }
        .error { background: #4d1e1e; border-color: #ff6b6b; }
        .log {
            background: #000;
            color: #0ff;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Monaco', 'Consolas', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
        }
        button:hover { background: #0056cc; }
        .btn-success { background: #51cf66; }
        .btn-warning { background: #ffd43b; color: #000; }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: 600;
        }
        .status.success { background: #1e4d1e; color: #51cf66; }
        .status.error { background: #4d1e1e; color: #ff6b6b; }
        .status.info { background: #1e3a4d; color: #74c0fc; }
        .form-sim {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .form-sim input, .form-sim select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #555;
            border-radius: 4px;
            background: #222;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>üîß Error Corregido</h1>
        <p>Verificaci√≥n: simulatePaymentPreparation ‚Üí setupPaymentData</p>
    </div>

    <div class="section success">
        <h2>‚úÖ Error Identificado y Corregido</h2>
        <p><strong>Error original:</strong> <code>TypeError: this.simulatePaymentPreparation is not a function</code></p>
        <p><strong>Soluci√≥n aplicada:</strong> Reemplazada con funci√≥n <code>setupPaymentData()</code> que configura correctamente los datos del pago</p>
    </div>

    <div class="section">
        <h2>üß™ Simulaci√≥n de Formulario</h2>
        <div class="form-sim">
            <input type="text" name="nombre" placeholder="Nombre completo" value="Juan P√©rez">
            <input type="email" name="correo" placeholder="Correo electr√≥nico" value="juan@example.com">
            <input type="tel" name="telefono" placeholder="Tel√©fono" value="3001234567">
            <input type="text" name="direccion" placeholder="Direcci√≥n" value="Calle 123 #45-67">
            <input type="text" name="monto" placeholder="Monto" value="50000">
            <select id="metodo_pago" name="metodo_pago">
                <option value="PSE Bold">PSE Bold</option>
                <option value="Tarjeta">Tarjeta</option>
            </select>
        </div>
    </div>

    <div class="section">
        <h2>üß™ Tests de Verificaci√≥n</h2>
        
        <button onclick="testSetupPaymentData()">üìã Test setupPaymentData</button>
        <button onclick="testFullInitialization()">üöÄ Test Inicializaci√≥n Completa</button>
        <button onclick="testErrorHandling()">‚ùå Test Manejo de Errores</button>
        <button onclick="clearLog()">üßπ Limpiar Log</button>
        
        <div id="status" class="status info">
            Listo para verificar la correcci√≥n del error...
        </div>
        
        <div id="log" class="log"></div>
    </div>

    <!-- Container Bold -->
    <div id="bold-payment-container" style="background: #333; padding: 20px; border-radius: 8px; margin: 20px 0; min-height: 100px;">
        <div style="text-align: center; color: #888;">
            üîí Container Bold - Listo para inicializaci√≥n
        </div>
    </div>

    <script>
        let logElement = document.getElementById('log');
        let statusElement = document.getElementById('status');
        
        function updateStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const colors = {
                info: '#0ff',
                error: '#ff6b6b',
                success: '#51cf66',
                warning: '#ffd43b'
            };
            
            const logEntry = `[${timestamp}] ${message}\n`;
            logElement.innerHTML += `<span style="color: ${colors[type]}">${logEntry}</span>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            logElement.innerHTML = '';
            updateStatus('Log limpiado', 'info');
        }

        // Simulaci√≥n de la clase PaymentUX con la funci√≥n corregida
        class PaymentUXTest {
            constructor() {
                this.ui = {
                    container: document.getElementById('bold-payment-container')
                };
                this.paymentState = {
                    initialized: false,
                    inProgress: false,
                    orderId: null
                };
            }

            setupPaymentData() {
                log('üìã Configurando datos del pago...', 'info');
                
                try {
                    // Obtener datos del formulario
                    const customerData = {
                        email: document.querySelector('input[name="correo"]')?.value || '',
                        fullName: document.querySelector('input[name="nombre"]')?.value || '',
                        phone: document.querySelector('input[name="telefono"]')?.value || '',
                        dialCode: '+57'
                    };

                    const billingAddress = {
                        address: document.querySelector('input[name="direccion"]')?.value || '',
                        city: 'Bogot√°',
                        state: 'Cundinamarca',
                        country: 'CO'
                    };

                    // Obtener monto
                    let monto = 0;
                    const montoField = document.querySelector('input[name="monto"]');
                    if (montoField && montoField.value) {
                        const rawValue = montoField.value.replace(/[^\d]/g, '');
                        monto = parseInt(rawValue) || 0;
                    }

                    // Obtener m√©todo de pago
                    const metodoPago = document.getElementById('metodo_pago')?.value || 'PSE Bold';

                    // Guardar datos globalmente para uso posterior
                    window.currentOrderData = {
                        orderId: this.paymentState.orderId,
                        amount: monto,
                        method: metodoPago,
                        customer: customerData,
                        billing: billingAddress
                    };

                    log('‚úÖ Datos de pago configurados:', 'success');
                    log(`   - Orden: ${this.paymentState.orderId}`, 'info');
                    log(`   - Monto: $${monto.toLocaleString()}`, 'info');
                    log(`   - Cliente: ${customerData.fullName}`, 'info');
                    log(`   - Email: ${customerData.email}`, 'info');
                    log(`   - M√©todo: ${metodoPago}`, 'info');

                    return true;
                } catch (error) {
                    log('‚ùå Error configurando datos del pago: ' + error.message, 'error');
                    return false;
                }
            }

            initializeBoldPaymentEnhanced() {
                if (!this.ui.container) {
                    log('‚ùå Container no encontrado', 'error');
                    return false;
                }

                log('üöÄ Inicializando pago Bold con UX mejorada...', 'info');
                
                try {
                    // Actualizar estado
                    this.paymentState.initialized = true;
                    this.paymentState.inProgress = true;
                    this.paymentState.orderId = 'SEQ-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

                    // Mostrar loading
                    this.ui.container.innerHTML = `
                        <div style="text-align: center; padding: 20px; background: #1e4d1e; border-radius: 8px;">
                            <div style="color: #51cf66; font-size: 1.2rem; margin-bottom: 10px;">
                                üîÑ Configurando pago...
                            </div>
                            <div style="color: #888; font-size: 0.9rem;">
                                Orden: ${this.paymentState.orderId}
                            </div>
                        </div>
                    `;

                    // Configurar datos del pago (FUNCI√ìN CORREGIDA)
                    const dataResult = this.setupPaymentData();
                    
                    if (dataResult) {
                        this.ui.container.innerHTML = `
                            <div style="text-align: center; padding: 20px; background: #1e4d1e; border-radius: 8px;">
                                <div style="color: #51cf66; font-size: 1.2rem; margin-bottom: 10px;">
                                    ‚úÖ Pago Listo
                                </div>
                                <button style="background: #007aff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
                                    üí≥ Pagar con Bold
                                </button>
                                <div style="margin-top: 10px; color: #888; font-size: 0.9rem;">
                                    Datos configurados correctamente
                                </div>
                            </div>
                        `;
                    }
                    
                    log('‚úÖ UX mejorada inicializada correctamente', 'success');
                    return true;
                } catch (error) {
                    log('‚ùå Error en UX mejorada: ' + error.message, 'error');
                    return false;
                }
            }
        }

        // Instancia de prueba
        const paymentUXTest = new PaymentUXTest();

        // Tests
        function testSetupPaymentData() {
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('üß™ TEST 1: FUNCI√ìN setupPaymentData', 'warning');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            updateStatus('Test 1: Verificando funci√≥n setupPaymentData', 'info');
            
            // Configurar orden ID para la prueba
            paymentUXTest.paymentState.orderId = 'TEST-' + Date.now();
            
            const result = paymentUXTest.setupPaymentData();
            
            if (result === true) {
                updateStatus('‚úÖ Test 1 EXITOSO: setupPaymentData funciona correctamente', 'success');
                log('üéâ FUNCI√ìN CORREGIDA: Ya no hay error de funci√≥n indefinida', 'success');
            } else {
                updateStatus('‚ùå Test 1 FALL√ì: setupPaymentData retorn√≥ error', 'error');
            }
            
            // Verificar que se crearon los datos globales
            if (window.currentOrderData) {
                log('‚úÖ Datos globales creados correctamente', 'success');
                log(`   currentOrderData: ${JSON.stringify(window.currentOrderData, null, 2)}`, 'info');
            } else {
                log('‚ùå No se crearon los datos globales', 'error');
            }
        }

        function testFullInitialization() {
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('üß™ TEST 2: INICIALIZACI√ìN COMPLETA', 'warning');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            updateStatus('Test 2: Probando inicializaci√≥n completa sin errores', 'info');
            
            const result = paymentUXTest.initializeBoldPaymentEnhanced();
            
            if (result === true) {
                updateStatus('‚úÖ Test 2 EXITOSO: Inicializaci√≥n completa sin errores', 'success');
                log('üéâ PROBLEMA RESUELTO: Ya no hay "simulatePaymentPreparation is not a function"', 'success');
            } else {
                updateStatus('‚ùå Test 2 FALL√ì: Error en inicializaci√≥n', 'error');
            }
        }

        function testErrorHandling() {
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('üß™ TEST 3: MANEJO DE ERRORES', 'warning');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            updateStatus('Test 3: Verificando manejo robusto de errores', 'info');
            
            // Simular error quitando un campo
            const originalName = document.querySelector('input[name="nombre"]');
            const tempValue = originalName.value;
            originalName.value = '';
            
            try {
                const result = paymentUXTest.setupPaymentData();
                log(`Resultado con campo vac√≠o: ${result}`, result ? 'success' : 'warning');
                
                // Restaurar valor
                originalName.value = tempValue;
                
                updateStatus('‚úÖ Test 3 EXITOSO: Manejo de errores funciona correctamente', 'success');
            } catch (error) {
                log('‚ùå Error no manejado: ' + error.message, 'error');
                updateStatus('‚ùå Test 3: Error no manejado correctamente', 'error');
                
                // Restaurar valor
                originalName.value = tempValue;
            }
        }

        // Inicializaci√≥n
        log('üöÄ Sistema de Test de Error Corregido Inicializado', 'success');
        log('Verificando correcci√≥n: simulatePaymentPreparation ‚Üí setupPaymentData', 'info');
        updateStatus('Sistema listo para verificar correcci√≥n del error', 'info');
    </script>
</body>
</html>
