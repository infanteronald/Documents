<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bold PSE Simple</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            color: #cccccc;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }
        
        #bold-container {
            min-height: 60px;
            border: 1px solid #007aff;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
        }
        
        .loading {
            color: #007aff;
        }
        
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #0056d3;
        }
    </style>
    <script src="https://checkout.bold.co/library/boldPaymentButton.js"></script>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Bold PSE - Sequoia Speed</h1>
        
        <p>Este es un test simple para verificar la integraci√≥n con Bold PSE.</p>
        
        <button onclick="initBoldTest()">Inicializar Bold PSE</button>
        
        <div id="bold-container">
            <p class="loading">Presiona el bot√≥n para inicializar Bold PSE</p>
        </div>
        
        <div id="log" style="background: #1e1e1e; padding: 10px; margin-top: 20px; font-family: monospace; font-size: 12px; white-space: pre-wrap;"></div>
    </div>

    <script>
        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        async function initBoldTest() {
            const container = document.getElementById('bold-container');
            log('Iniciando test Bold PSE...');
            
            container.innerHTML = '<p class="loading">Generando hash de seguridad...</p>';
            
            const orderId = 'TEST-' + Date.now();
            const amount = 10000; // $10,000 COP para prueba
            
            try {
                // Generar hash
                log(`Generando hash para orden: ${orderId}, monto: ${amount}`);
                
                const hashResponse = await fetch('bold_hash.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        order_id: orderId,
                        amount: amount,
                        currency: 'COP'
                    })
                });

                log(`Respuesta hash status: ${hashResponse.status}`);

                if (!hashResponse.ok) {
                    const errorText = await hashResponse.text();
                    throw new Error(`Error HTTP ${hashResponse.status}: ${errorText}`);
                }

                const hashData = await hashResponse.json();
                log(`Hash data: ${JSON.stringify(hashData, null, 2)}`);
                
                if (!hashData.success) {
                    throw new Error(hashData.error || 'Error en servidor hash');
                }

                // Configurar Bold
                container.innerHTML = '<p class="loading">Inicializando checkout Bold...</p>';
                
                setTimeout(() => {
                    container.innerHTML = '';
                    
                    const script = document.createElement('script');
                    script.src = 'https://checkout.bold.co/library/boldPaymentButton.js';
                    script.setAttribute('data-bold-button', 'dark-L');
                    script.setAttribute('data-api-key', hashData.data.api_key);
                    script.setAttribute('data-amount', hashData.data.amount.toString());
                    script.setAttribute('data-currency', 'COP');
                    script.setAttribute('data-order-id', orderId);
                    script.setAttribute('data-description', 'Test Sequoia Speed PSE');
                    script.setAttribute('data-integrity-signature', hashData.data.integrity_signature);
                    script.setAttribute('data-render-mode', 'embedded');
                    
                    container.appendChild(script);
                    
                    log('Script Bold agregado al DOM');
                    
                    // Verificar si se cre√≥ el bot√≥n
                    setTimeout(() => {
                        const boldButton = container.querySelector('[data-bold-button]');
                        if (boldButton) {
                            log('‚úÖ Bot√≥n Bold creado exitosamente');
                        } else {
                            log('‚ùå Bot√≥n Bold no se cre√≥');
                        }
                    }, 2000);
                    
                }, 1000);

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                container.innerHTML = `<p style="color: #ff6b6b;">Error: ${error.message}</p>`;
            }
        }

        // Escuchar eventos de Bold
        window.addEventListener('message', function(event) {
            if (event.origin !== 'https://checkout.bold.co') return;
            
            log(`üì® Evento Bold: ${JSON.stringify(event.data, null, 2)}`);
            
            switch (event.data.type) {
                case 'PAYMENT_SUCCESS':
                    log('‚úÖ Pago exitoso!');
                    break;
                case 'PAYMENT_ERROR':
                    log('‚ùå Error en pago');
                    break;
                case 'PAYMENT_CANCELLED':
                    log('üö´ Pago cancelado');
                    break;
                default:
                    log(`‚ÑπÔ∏è Evento: ${event.data.type}`);
            }
        });

        log('Test Bold PSE inicializado');
    </script>
</body>
</html>
