# ====================================================
# ğŸ§¹ FUNCIONES DE LIMPIEZA PARA SEQUOIA SPEED
# =========    echo "ğŸ“„ Archivos .md: $md_count"
    echo "ğŸ—„ï¸ Archivos .sql: $sql_count"
    echo "ğŸ” Archivos debug_*: $debug_count"
    echo "ğŸ§ª Archivos test/script/temp: $test_count"
    echo "ğŸ”§ Archivos migrate/check/verificar: $migrate_count"=======================================

# FunciÃ³n principal de limpieza completa integrada
limpiar() {
    local current_dir=$(pwd)
    local project_dir="/Users/ronaldinfante/Documents/pedidos"

    echo "ğŸ§¹ LIMPIADOR COMPLETO DE ARCHIVOS TEMPORALES"
    echo "ğŸ“‚ Cambiando al directorio del proyecto..."

    cd "$project_dir" || {
        echo "âŒ Error: No se pudo acceder al directorio del proyecto"
        return 1
    }

    echo "ğŸ“‚ Directorio: $(pwd)"
    echo ""

    local total=0

    echo "ğŸ¯ INICIANDO LIMPIEZA POR CATEGORÃAS:"
    echo ""

    # Activar modo de expansiÃ³n de nombres de archivo
    setopt NULL_GLOB

    # ====================================================
    # ğŸ“„ ARCHIVOS .MD - OMITIDOS (PRESERVADOS)
    # ====================================================
    echo "ğŸ“„ [1/4] Archivos .md preservados (no se borran)..."
    local md_count=0
    for file in *.md; do
        if [[ -f "$file" ]]; then
            ((md_count++))
            echo "    âœ… Preservado: $file"
        fi
    done
    echo "    âœ… Archivos .md preservados: $md_count archivos"

    # ====================================================
    # ï¿½ï¸ BORRAR TODOS LOS ARCHIVOS .SQL
    # ====================================================
    echo ""
    echo "ï¿½ï¸ [2/4] Borrando archivos .sql..."
    local sql_count=0
    for file in *.sql; do
        if [[ -f "$file" ]]; then
            ((sql_count++))
            ((total++))
            rm -f "$file" && echo "    ğŸ—‘ï¸  Borrado: $file"
        fi
    done
    echo "    âœ… Archivos .sql: $sql_count archivos"

    # ====================================================
    # ï¿½ BORRAR ARCHIVOS DEBUG_*
    # ====================================================
    echo ""
    echo "ï¿½ [3/4] Borrando archivos debug_*..."
    local debug_count=0
    for file in debug_*; do
        if [[ -f "$file" ]]; then
            ((debug_count++))
            ((total++))
            rm -f "$file" && echo "    ğŸ—‘ï¸  Borrado: $file"
        fi
    done
    echo "    âœ… Archivos debug_*: $debug_count archivos"

    # ====================================================
    # ğŸ§ª BORRAR ARCHIVOS TEST_* Y SCRIPT_*
    # ====================================================
    echo ""
    echo "ğŸ§ª [4/5] Borrando archivos test_* y script_*..."
    local test_count=0
    for file in test_* script_* temp_* prueba_*; do
        if [[ -f "$file" ]]; then
            ((test_count++))
            ((total++))
            rm -f "$file" && echo "    ğŸ—‘ï¸  Borrado: $file"
        fi
    done
    echo "    âœ… Archivos test/script/temp: $test_count archivos"

    # ====================================================
    # ğŸ”§ BORRAR ARCHIVOS DE MIGRACIÃ“N Y VERIFICACIÃ“N
    # ====================================================
    echo ""
    echo "ğŸ”§ [5/5] Borrando archivos de migraciÃ³n y verificaciÃ³n..."
    local migrate_count=0
    for file in migrate_* check_* verificar_* migration_*; do
        if [[ -f "$file" ]]; then
            ((migrate_count++))
            ((total++))
            rm -f "$file" && echo "    ğŸ—‘ï¸  Borrado: $file"
        fi
    done
    echo "    âœ… Archivos migrate/check/verificar: $migrate_count archivos"

    # Desactivar modo NULL_GLOB
    unsetopt NULL_GLOB

    # ====================================================
    # ğŸ“Š RESUMEN FINAL
    # ====================================================
    echo ""
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“Š RESUMEN DE LIMPIEZA"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“„ Archivos .md: $md_count"
    echo "ğŸ—„ï¸ Archivos .sql: $sql_count"
    echo "ï¿½ Archivos debug_*: $debug_count"
    echo "ğŸ§ª Archivos test/script/temp: $test_count"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "âœ… Total archivos borrados: $total"

    if [[ $total -gt 0 ]]; then
        echo "ğŸš€ Â¡Proyecto limpio!"
    else
        echo "ğŸ‰ Â¡El proyecto ya estaba limpio!"
    fi
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    # Regresar al directorio original
    cd "$current_dir"
}

# FunciÃ³n para sincronizaciÃ³n manual con limpieza previa
sync-sequoia() {
    echo "ğŸ§¹ Ejecutando limpieza antes de sincronizar..."

    # Cambiar al directorio del proyecto
    local current_dir=$(pwd)
    local project_dir="/Users/ronaldinfante/Documents/pedidos"

    cd "$project_dir" || {
        echo "âŒ Error: No se pudo acceder al directorio del proyecto"
        return 1
    }

    # Ejecutar limpieza de archivos temporales usando funciÃ³n integrada
    echo "ğŸ—‘ï¸ Limpiando archivos temporales..."
    limpiar

    echo "ğŸ“¤ Sincronizando archivos con servidor (modo verboso)..."

    # Configurar locale para evitar warnings de perl
    export LC_ALL=C
    export LANG=C
    export LANGUAGE=

    # Usar rsync para sincronizaciÃ³n mÃ¡s eficiente
    rsync -azv \
        --exclude='.vscode/' \
        --exclude='.git/' \
        --exclude='.DS_Store' \
        --exclude='*.log' \
        --exclude='.zsh*' \
        --exclude='CLAUDE.md' \
        --exclude='**/check_sftp_status.sh' \
        --exclude='**/clean-temp-files.sh' \
        --exclude='**/test_*.html' \
        --exclude='**/*_fixed.php' \
        -e "ssh -i /Users/ronaldinfante/id_rsa -p 7822 -o PasswordAuthentication=no -o PreferredAuthentications=publickey" \
        /Users/ronaldinfante/Documents/pedidos/ \
        motodota@68.66.226.124:/home/motodota/sequoiaspeed.com.co/pedidos/

    # Restaurar locale original
    export LC_ALL=
    export LANG="es_ES.UTF-8"

    # Regresar al directorio original
    cd "$current_dir"

    if [[ $? -eq 0 ]]; then
        echo "âœ… SincronizaciÃ³n completada"
    else
        echo "âŒ Error en sincronizaciÃ³n"
    fi
}

echo "âœ… Funciones Sequoia Speed cargadas - Limpieza integrada"
echo "ğŸ’¡ Comandos disponibles:"
echo "   limpiar          - Limpieza completa"
echo "   sync-sequoia     - Limpieza + sincronizaciÃ³n"
