<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final - Error Corregido</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ddd; padding: 15px; margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        #bold-payment-container { border: 2px dashed #ccc; padding: 20px; margin: 20px 0; }
        .log-output { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Test Final - Error this.setupPaymentData() Corregido</h1>

    <div class="test-section">
        <h2>üìã Formulario de Prueba</h2>
        <form id="test-form">
            <input type="text" name="nombre" value="Juan P√©rez" placeholder="Nombre">
            <input type="email" name="correo" value="juan@test.com" placeholder="Email">
            <input type="tel" name="telefono" value="3001234567" placeholder="Tel√©fono">
            <input type="text" name="direccion" value="Calle 123 #45-67" placeholder="Direcci√≥n">
            <select name="categoria">
                <option value="camisetas">Camisetas</option>
            </select>
            <select name="talla">
                <option value="M">M</option>
            </select>
            <input type="number" name="cantidad" value="2" placeholder="Cantidad">
        </form>
    </div>

    <div class="test-section">
        <h2>üî≤ Contenedor Bold Payment</h2>
        <div id="bold-payment-container">
            <p>Contenedor listo para Bold Payment</p>
        </div>
    </div>

    <div class="test-section">
        <h2>üöÄ Tests de Funcionalidad</h2>
        <button onclick="testInitializeBoldPayment()">Test initializeBoldPayment()</button>
        <button onclick="testPaymentUXEnhanced()">Test PaymentUX Enhanced</button>
        <button onclick="testSetupPaymentData()">Test setupPaymentData()</button>
        <button onclick="runAllTests()">üß™ Ejecutar Todos los Tests</button>
    </div>

    <div class="test-section">
        <h2>üìä Resultados</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>üìù Log de Consola</h2>
        <div id="console-log" class="log-output"></div>
    </div>

    <!-- Scripts de Bold Payment -->
    <script src="payment_ux_enhanced.js"></script>

    <script>
        // Interceptar console.log para mostrar en la p√°gina
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('console-log');

        function addToLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] <span class="${type}">${message}</span>`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'info');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };

        // Funciones de test
        function testInitializeBoldPayment() {
            console.log('üîç Testing initializeBoldPayment()...');
            
            try {
                if (typeof window.initializeBoldPayment !== 'function') {
                    throw new Error('initializeBoldPayment no est√° definida');
                }

                const result = window.initializeBoldPayment();
                console.log('‚úÖ initializeBoldPayment() returned:', result);
                
                if (result === undefined) {
                    throw new Error('Function returned undefined!');
                }

                addTestResult('initializeBoldPayment()', true, `Returned: ${result}`);
                return true;
            } catch (error) {
                console.error('‚ùå Error in initializeBoldPayment():', error);
                addTestResult('initializeBoldPayment()', false, error.message);
                return false;
            }
        }

        function testPaymentUXEnhanced() {
            console.log('üîç Testing PaymentUX Enhanced...');
            
            try {
                if (!window.paymentUX) {
                    throw new Error('PaymentUX no est√° inicializada');
                }

                const result = window.paymentUX.initializeBoldPaymentEnhanced();
                console.log('‚úÖ PaymentUX Enhanced returned:', result);
                
                addTestResult('PaymentUX Enhanced', true, `Returned: ${result}`);
                return true;
            } catch (error) {
                console.error('‚ùå Error in PaymentUX Enhanced:', error);
                addTestResult('PaymentUX Enhanced', false, error.message);
                return false;
            }
        }

        function testSetupPaymentData() {
            console.log('üîç Testing setupPaymentData()...');
            
            try {
                if (typeof setupPaymentData !== 'function') {
                    throw new Error('setupPaymentData no est√° definida');
                }

                const result = setupPaymentData();
                console.log('‚úÖ setupPaymentData() returned:', result);
                
                // Verificar que se cre√≥ window.currentOrderData
                if (window.currentOrderData) {
                    console.log('‚úÖ window.currentOrderData creado:', window.currentOrderData);
                }

                addTestResult('setupPaymentData()', true, `Returned: ${result}`);
                return true;
            } catch (error) {
                console.error('‚ùå Error in setupPaymentData():', error);
                addTestResult('setupPaymentData()', false, error.message);
                return false;
            }
        }

        function addTestResult(testName, success, details) {
            const resultsDiv = document.getElementById('test-results');
            const resultElement = document.createElement('div');
            resultElement.className = success ? 'success' : 'error';
            resultElement.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${testName}</strong><br>
                <em>${details}</em>
            `;
            resultsDiv.appendChild(resultElement);
        }

        function runAllTests() {
            console.log('üöÄ Ejecutando todos los tests...');
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('console-log').innerHTML = '';
            
            setTimeout(() => {
                testSetupPaymentData();
                setTimeout(() => {
                    testPaymentUXEnhanced();
                    setTimeout(() => {
                        testInitializeBoldPayment();
                        console.log('üèÅ Todos los tests completados');
                    }, 100);
                }, 100);
            }, 100);
        }

        // Auto-ejecutar tests al cargar
        window.addEventListener('load', () => {
            console.log('üîß P√°gina cargada, ejecutando tests autom√°ticamente...');
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>
