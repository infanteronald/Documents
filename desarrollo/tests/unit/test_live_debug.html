<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Live Debug - Bold Payment Function</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #1e1e1e;
            color: #ffffff;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #3a3a3a;
            border-radius: 6px;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        #bold-payment-container {
            border: 2px solid #007aff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
            min-height: 100px;
            background: #2a2a2a;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #28a745; }
        .error { background: #dc3545; }
        .warning { background: #ffc107; color: #000; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test Live Debug - Bold Payment Function</h1>
        
        <div class="test-section">
            <h2>üéØ Prueba Directa de initializeBoldPayment()</h2>
            <p>Esta prueba ejecutar√° la funci√≥n directamente y mostrar√° todos los logs en tiempo real.</p>
            
            <button onclick="testInitializeBoldPayment()">üöÄ Ejecutar initializeBoldPayment()</button>
            <button onclick="clearConsole()">üßπ Limpiar Console</button>
            <button onclick="showGlobalState()">üåç Ver Estado Global</button>
        </div>

        <div class="test-section">
            <h3>üìä Estado de la Funci√≥n</h3>
            <div id="function-status" class="status warning">‚è≥ Sin ejecutar</div>
        </div>

        <div class="test-section">
            <h3>üí≥ Contenedor Bold Payment</h3>
            <div id="bold-payment-container">
                <div style="text-align: center; color: #888;">
                    Container vac√≠o - esperando inicializaci√≥n
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üìù Console Output</h3>
            <div id="console-output" class="console-output">Esperando ejecuci√≥n...</div>
        </div>

        <div class="test-section">
            <h3>üîß Simulaci√≥n de Datos del Formulario</h3>
            <form id="test-form" style="display: none;">
                <input type="hidden" name="monto" value="50000">
                <input type="hidden" name="correo" value="test@sequoiaspeed.com">
                <input type="hidden" name="nombre" value="Usuario Test">
                <input type="hidden" name="telefono" value="3001234567">
                <input type="hidden" name="direccion" value="Calle Test 123">
                <select id="metodo_pago" name="metodo_pago">
                    <option value="card">Tarjeta de Cr√©dito</option>
                </select>
            </form>
        </div>
    </div>

    <script>
        // Capturar todos los console.log y mostrarlos en pantalla
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        let consoleOutput = '';
        
        function updateConsoleOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : 'üìù';
            consoleOutput += `[${timestamp}] ${prefix} ${message}\n`;
            document.getElementById('console-output').textContent = consoleOutput;
            document.getElementById('console-output').scrollTop = document.getElementById('console-output').scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            updateConsoleOutput(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            updateConsoleOutput(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            updateConsoleOutput(args.join(' '), 'warn');
        };

        function clearConsole() {
            consoleOutput = '';
            document.getElementById('console-output').textContent = 'Console limpiado...';
        }

        function showGlobalState() {
            console.log('=== ESTADO GLOBAL ===');
            console.log('window.initializeBoldPayment existe:', typeof window.initializeBoldPayment);
            console.log('document.getElementById existe:', typeof document.getElementById);
            console.log('Container bold-payment-container:', document.getElementById('bold-payment-container'));
            console.log('Formulario test:', document.getElementById('test-form'));
            console.log('Campo metodo_pago:', document.getElementById('metodo_pago'));
            console.log('=== FIN ESTADO GLOBAL ===');
        }

        function testInitializeBoldPayment() {
            const statusDiv = document.getElementById('function-status');
            statusDiv.textContent = '‚è≥ Ejecutando...';
            statusDiv.className = 'status warning';
            
            console.log('üî• =================================');
            console.log('üî• INICIANDO PRUEBA DIRECTA');
            console.log('üî• =================================');
            
            try {
                // Verificar si la funci√≥n existe
                if (typeof initializeBoldPayment !== 'function') {
                    console.error('‚ùå ERROR: initializeBoldPayment no es una funci√≥n');
                    console.error('‚ùå Tipo actual:', typeof initializeBoldPayment);
                    statusDiv.textContent = '‚ùå Funci√≥n no encontrada';
                    statusDiv.className = 'status error';
                    return;
                }
                
                console.log('‚úÖ Funci√≥n initializeBoldPayment encontrada');
                console.log('üöÄ Ejecutando initializeBoldPayment()...');
                
                // Ejecutar la funci√≥n y capturar el resultado
                const result = initializeBoldPayment();
                
                console.log('üìä Resultado de la funci√≥n:', result);
                console.log('üìä Tipo del resultado:', typeof result);
                
                if (result === true) {
                    statusDiv.textContent = '‚úÖ Funci√≥n ejecutada exitosamente - Retorn√≥ TRUE';
                    statusDiv.className = 'status success';
                } else if (result === false) {
                    statusDiv.textContent = '‚ùå Funci√≥n ejecutada - Retorn√≥ FALSE';
                    statusDiv.className = 'status error';
                } else if (result === undefined) {
                    statusDiv.textContent = '‚ö†Ô∏è Funci√≥n ejecutada - Retorn√≥ UNDEFINED';
                    statusDiv.className = 'status warning';
                } else {
                    statusDiv.textContent = `ü§î Funci√≥n ejecutada - Retorn√≥: ${result}`;
                    statusDiv.className = 'status warning';
                }
                
            } catch (error) {
                console.error('‚ùå ERROR durante la ejecuci√≥n:', error);
                console.error('‚ùå Mensaje:', error.message);
                console.error('‚ùå Stack:', error.stack);
                statusDiv.textContent = '‚ùå Error durante la ejecuci√≥n';
                statusDiv.className = 'status error';
            }
            
            console.log('üî• =================================');
            console.log('üî• PRUEBA COMPLETADA');
            console.log('üî• =================================');
        }

        // Funci√≥n initializeBoldPayment copiada directamente del archivo principal
        function initializeBoldPayment() {
            console.log('üöÄ initializeBoldPayment() INICIADA');
            console.log('üïê Timestamp:', new Date().toISOString());
            
            // Capturar errores globales durante la ejecuci√≥n
            window.addEventListener('error', function(e) {
                console.error('‚ùå ERROR GLOBAL durante initializeBoldPayment:', e.message, 'en', e.filename, 'l√≠nea', e.lineno);
            });
            
            try {
                console.log('üîß PASO 1: Intentando obtener container...');
                
                const container = document.getElementById('bold-payment-container');
                console.log('üîç Container encontrado:', container);
                
                if (!container) {
                    console.error('‚ùå Container Bold no encontrado - RETORNANDO FALSE');
                    return false;
                }
                
                console.log('‚úÖ Container Bold encontrado y verificado');

                // Mostrar informaci√≥n del pago
                console.log('üîß PASO 2: Intentando mostrar loading...');
                container.innerHTML = '<div style="text-align: center; padding: 16px; color: #007aff;">Preparando pago seguro...</div>';
                console.log('‚úÖ Loading mostrado exitosamente');

                // Generar ID √∫nico para la orden
                console.log('üîß PASO 3: Generando ID de orden...');
                const orderId = 'SEQ-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                console.log('‚úÖ ID orden generado:', orderId);
            
                // Obtener el monto del pedido con manejo seguro
                console.log('üîß PASO 4: Obteniendo monto...');
                let monto = 50000; // Valor fijo para prueba
                console.log('‚úÖ Monto para prueba:', monto, 'Tipo:', typeof monto);
                
                // Obtener el m√©todo de pago seleccionado
                console.log('üîß PASO 5: Obteniendo m√©todo de pago...');
                const metodoPago = document.getElementById('metodo_pago').value;
                console.log('‚úÖ M√©todo de pago:', metodoPago);
                
                console.log('üîß PASO 6: Preparando Bold con m√©todo:', metodoPago, 'monto:', monto);
                
                console.log('üí∞ Monto final para Bold:', monto);
                
                console.log('üîÑ Iniciando proceso de preparaci√≥n Bold...');
                // Obtener datos del cliente del formulario
                const customerData = {
                    email: 'test@sequoiaspeed.com',
                    fullName: 'Usuario Test',
                    phone: '3001234567',
                    dialCode: '+57'
                };
                console.log('üë§ Datos del cliente:', customerData);

                // Datos de direcci√≥n de facturaci√≥n
                const billingAddress = {
                    address: 'Calle Test 123',
                    city: 'Bogot√°',
                    state: 'Cundinamarca',
                    country: 'CO'
                };
                console.log('üìç Direcci√≥n de facturaci√≥n:', billingAddress);

                // Crear URL para la ventana de pago
                const paymentParams = new URLSearchParams({
                    order_id: orderId,
                    amount: monto,
                    method: metodoPago,
                    customer_data: JSON.stringify(customerData),
                    billing_address: JSON.stringify(billingAddress)
                });

                const paymentUrl = 'bold_payment.php?' + paymentParams.toString();
                console.log('üîó URL de pago generada:', paymentUrl);
                
                // Mostrar bot√≥n para abrir ventana de pago
                console.log('üé® Creando bot√≥n de pago...');
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <button type="button" onclick="alert('Bot√≥n funcionando! URL: ${paymentUrl}')" 
                                style="background: #007aff; color: white; border: none; 
                                       padding: 12px 24px; border-radius: 6px; 
                                       font-weight: 600; font-size: 0.9rem; cursor: pointer;
                                       transition: all 0.2s;">
                            üîí Abrir Pago Seguro (PRUEBA)
                        </button>
                        <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #888;">
                            Bot√≥n de prueba - Orden: ${orderId}
                        </p>
                    </div>
                `;
                
                console.log('‚úÖ Bot√≥n de pago creado exitosamente');

                // Guardar informaci√≥n del pedido para uso posterior
                window.currentOrderData = {
                    orderId: orderId,
                    amount: monto,
                    method: metodoPago,
                    customer: customerData,
                    billing: billingAddress
                };
                
                console.log('üíæ Datos del pedido guardados:', window.currentOrderData);
                console.log('üéâ initializeBoldPayment() COMPLETADA EXITOSAMENTE');
                console.log('üïê Timestamp final:', new Date().toISOString());
                
                return true; // Retornar √©xito

            } catch (error) {
                console.error('‚ùå ERROR CAPTURADO en initializeBoldPayment:', error);
                console.error('‚ùå Mensaje:', error.message);
                console.error('‚ùå Stack trace:', error.stack);
                console.error('‚ùå Timestamp error:', new Date().toISOString());
                
                const container = document.getElementById('bold-payment-container');
                if (container) {
                    container.innerHTML = '<div style="color: #ff6b6b; text-align: center; padding: 16px;">Error al inicializar el pago. Intente nuevamente.</div>';
                }
                return false; // Retornar error
            }
        }

        // Inicializar la prueba
        console.log('üìã P√°gina de prueba cargada - Lista para ejecutar tests');
        showGlobalState();
    </script>
</body>
</html>
